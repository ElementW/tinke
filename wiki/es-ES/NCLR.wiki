#summary Documentación sobre archivos NCLR
#labels Info-Format

Estos archivos, cuyo nombre podría ser _"Nintendo CoLour Resource"_, se usan en muchos juegos. Contienen la *paleta* de una imagen,
pudiendo contener un archivo más de una paleta (4-bpp). Son reconocidos por su cabecera (NCLR o RLCN) y generalmente tienen esa misma extensión

=Estructura de la paleta=

||_Posición_||_Tipo_||_Descripción_||

*Cabecera genérica*

||0x00||char`[4]`||ID (NCLR)||
||0x04||ushort||Endianess (si es igual a 0xFFFE el ID se encuentra inverso)||
||0x06||ushort||Constante (debería ser 0x1000)||
||0x08||uint||Tamaño del archivo||
||0x0C||ushort||Tamaño de la cabecera||
||0x0E||ushort||# de secciones||

*Sección: PLTT (PaLeTTe)*

||0x00||char`[4]`||ID (PLTT)||
||0x04||uint||Tamaño de la sección||
||0x08||ushort||Profundidad (0x03 == 4bpp; 0x04 == 8bpp)||
||0x0A||ushort||Desconocido 1||
||0x0C||uint||Desconocido 2||
||0x10||uint||Tamaño de las paletas||
||0x14||uint||Posición de los colores comenzando desde el campo del tamaño (0x14)||

*Datos de las paletas (NTFP Nintendo Tile Format Palette)*

||0x00||byte`[2]`||Color codificado con BGR555||
||...||

*PMCP section (opcional)*

||0x00||char`[4]`||ID (PMCP)||
||0x04||uint||Longitud del bloque (suele ser 0x12)||
||0x08||ushort||Desconocido 1||
||0x0A||ushort||Desconocido 2||
||0x0C||uint||Desconocido 3||
||0x10||ushort||Número de la primera paleta||

 * _Nota:_ El número de paletas puede ser calculado de la siguiente forma:

{{{
int nPaletas = (Tamaño de paleta) / (# de colores * 2);
}}}

 * _Nota 1:_ El número de colores por paleta depende de la profundidad:
   * Si la profundidad es 4bpp hay 16 colores
   * Si la profundidad es 8bpp hay 256 colores
   
 * _Nota 2:_ El valor "Número de la primera paleta" en la sección PMCP indica el número por el que se empiezan
 a contar las paletas. Se usa en combinación con un archivo NSCR cuando éste en su información, en lugar de llamar
 a la primera paleta 0, la llama por ejemplo 0xE.

=Codificación BGR555=

Cada dos bytes representa un color definido por tres números (BGR Blue Green Red), estos están guardados en el bytes de la
siguiente forma:

XBBBBBGGGGGRRRRR

cada letras es un bit (5 bit por color), la letra X no se usa (siempre es 0).
Una forma de decodificar los dos bytes a un color es (en C#):

{{{
int r, b; double g;
short bgr = BitConverter.ToInt16(new Byte[] { byte1, byte2 }, 0);

r = (bgr & 0x001F) * 0x08;
g = ((bgr & 0x03E0) >> 5) * 0x08;
b = ((bgr & 0x7C00) >> 10) * 0x08;

return System.Drawing.Color.FromArgb(r, (int)g, b);
}}}

La codificación BGR555 permite un máximo de 32 valores (5 bits) por atributo (Rojo, Verde o Azul) haciendo un total de 32768 colores.